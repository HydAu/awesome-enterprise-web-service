lb:
  image: dockercloud/haproxy
  links:
    - webservice:webservice
  ports:
    - "8080:8080"
    - "8081:8081"
  roles:
    - global

db:
  image: mysql
  environment:
    MYSQL_ALLOW_EMPTY_PASSWORD: 'true'
    MYSQL_DATABASE: webservice
  expose:
    - "3306"

cache:
  image: redis
  expose:
    - "6379"

statsd:
  image: hopsoft/graphite-statsd
  restart: always
  expose:
    - "80"
    - "8125/udp"
    - "8126"

webservice:
  image: kkemple/awesome-enterprise-web-service
  command: "npm start"
  autoredeploy: true
  links:
    - db:db
    - cache:cache
    - statsd:statsd
  expose:
    - "8080"
    - "8081"
  environment:
    SECRET: secret
    NODE_ENV: compose
    MYSQL_HOST: db
    MYSQL_PORT: 3306
    MYSQL_DATABASE: webservice
    MYSQL_USERNAME: root
    REDIS_HOST: cache
    REDIS_PORT: 6379
    REDIS_PARTITION: webservice
    STATSD_HOST: statsd
    STATSD_PREFIX: webservice
